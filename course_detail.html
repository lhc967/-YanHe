<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程播放 - 商务汉语谈判</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root { --primary: #004aad; --accent: #ff6b00; --bg-light: #f8faff; }
        body { padding-top: 70px; background: var(--bg-light); font-family: -apple-system, "PingFang SC", sans-serif; }

        /* 导航栏保持一致 */
        .navbar-custom { background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); height: 70px; z-index: 1000; }
        .navbar-brand { font-weight: 900; color: var(--primary) !important; }
        .nav-avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; }

        /* 视频播放区 */
        .video-container {
            background: #000; width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .video-placeholder { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .play-btn-overlay {
            position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); color: #fff; cursor: pointer; transition: 0.3s;
        }
        .play-btn-overlay:hover { background: rgba(0,0,0,0.5); }

        /* 锁定遮罩 */
        .lock-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff;
            z-index: 10; display: none; /* 默认隐藏 */
        }

        /* 目录区 */
        .playlist-card { background: #fff; border-radius: 12px; border: 1px solid #eee; height: 100%; display: flex; flex-direction: column; }
        .playlist-header { padding: 20px; border-bottom: 1px solid #eee; }
        .video-tabs { display: flex; gap: 10px; margin-top: 10px; }
        .v-tab {
            font-size: 13px; padding: 4px 12px; border-radius: 20px; background: #f5f5f5; color: #666; cursor: pointer; transition: 0.2s;
        }
        .v-tab.active { background: var(--primary); color: #fff; }

        .chapter-list { flex: 1; overflow-y: auto; padding: 0; max-height: 500px; }
        .chapter-item {
            padding: 15px 20px; border-bottom: 1px solid #f9f9f9; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .chapter-item:hover { background: #f0f7ff; }
        .chapter-item.active { background: #eef4ff; border-left: 4px solid var(--primary); }
        .chapter-item.locked { opacity: 0.7; }

        .tag-free { font-size: 10px; background: #e6f9ed; color: #28a745; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .tag-paid { font-size: 10px; background: #fff0f0; color: #dc3545; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top navbar-custom">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="home_login.html">言禾 YanHe</a>
            <div class="d-flex align-items-center ms-auto gap-3">
                <a href="education_login.html" class="btn btn-outline-secondary btn-sm rounded-pill px-3">返回课程表</a>
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=LiHua" class="nav-avatar">
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="video-container" id="videoArea">
                    <img id="videoCover" src="https://images.unsplash.com/photo-1557804506-669a67965ba0?w=800" class="video-placeholder">

                    <div class="play-btn-overlay" id="playBtn" onclick="startVideo()">
                        <i class="bi bi-play-circle-fill" style="font-size: 60px;"></i>
                        <div class="mt-2 fw-bold">点击开始学习</div>
                    </div>

                    <div class="lock-overlay" id="lockMask">
                        <i class="bi bi-lock-fill" style="font-size: 50px; margin-bottom: 15px;"></i>
                        <h4 class="fw-bold">本节为高阶付费内容</h4>
                        <p class="text-white-50 mb-4">解锁本章及后续所有情景剧视频</p>
                        <button class="btn btn-danger rounded-pill px-5 fw-bold" onclick="goToPay(99)">
                            解锁本节 (¥ 99)
                        </button>
                        <button class="btn btn-link text-white small mt-2" onclick="previewFree()">试看 30 秒</button>
                    </div>
                </div>

                <div class="mt-4">
                    <h2 class="fw-bold" id="lessonTitle">01. 课程导论：中国人的谈判思维</h2>
                    <div class="d-flex gap-3 text-muted small mt-2">
                        <span><i class="bi bi-eye"></i> 1.2w 次观看</span>
                        <span><i class="bi bi-star-fill text-warning"></i> 4.9 分</span>
                        <span><i class="bi bi-clock"></i> 15:00</span>
                    </div>
                    <hr>
                    <h5 class="fw-bold mt-4">课程简介</h5>
                    <p class="text-secondary">本课程专为具备中级汉语水平的学习者设计，结合真实的商务场景，深度解析中国商业环境中的谈判策略与语言艺术。</p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="playlist-card">
                    <div class="playlist-header">
                        <h5 class="fw-bold m-0">课程目录</h5>
                        <div class="video-tabs">
                            <span class="v-tab active" onclick="filterType('all', this)">全部</span>
                            <span class="v-tab" onclick="filterType('grammar', this)">精讲课</span>
                            <span class="v-tab" onclick="filterType('scenario', this)">情景剧</span>
                            <span class="v-tab" onclick="filterType('culture', this)">文化角</span>
                        </div>
                    </div>

                    <div class="chapter-list" id="chapterList">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div style="position: fixed; bottom: 30px; right: 30px; z-index: 1050;">
        <button class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center"
                style="width: 60px; height: 60px; font-size: 24px;"
                onclick="toggleAiChat()">
            <i class="bi bi-robot"></i>
        </button>
    </div>

    <div class="card shadow-lg" id="aiChatBox" style="position: fixed; bottom: 100px; right: 30px; width: 350px; height: 500px; z-index: 1050; display: none; border-radius: 16px; border: none;">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center" style="border-radius: 16px 16px 0 0;">
            <span class="fw-bold"><i class="bi bi-robot me-2"></i>AI 助教</span>
            <button type="button" class="btn-close btn-close-white btn-sm" onclick="toggleAiChat()"></button>
        </div>
        <div class="card-body bg-light overflow-auto" id="chatBody">
            <div class="d-flex align-items-start mb-3">
                <div class="bg-white p-2 rounded shadow-sm small text-dark" style="max-width: 80%;">
                    你好！我是言禾 AI 助教。关于这节课有什么不懂的词汇，可以随时问我哦！
                </div>
            </div>
        </div>
        <div class="card-footer bg-white">
            <div class="input-group">
                <input type="text" class="form-control border-0 bg-light" placeholder="输入问题..." id="chatInput">
                <button class="btn btn-link text-primary" onclick="sendMessage()"><i class="bi bi-send-fill"></i></button>
            </div>
        </div>
    </div>

    <script>
        // 模拟课程数据
        const chapters = [
            { id: 1, title: "01. 导论：中国人的谈判思维", type: "grammar", isPaid: false, duration: "15:00" },
            { id: 2, title: "02. 核心词汇：报价与还价", type: "grammar", isPaid: false, duration: "22:30" },
            { id: 3, title: "03. 情景模拟：初次见面寒暄", type: "scenario", isPaid: true, price: 99, duration: "10:45" },
            { id: 4, title: "04. 情景模拟：酒桌上的博弈", type: "scenario", isPaid: true, price: 99, duration: "18:20" },
            { id: 5, title: "05. 文化：面子工程", type: "culture", isPaid: true, price: 199, duration: "12:00" },
            { id: 6, title: "06. 合同条款深度解析", type: "grammar", isPaid: true, price: 199, duration: "35:00" }
        ];

        // 初始化渲染
        renderChapters(chapters);

        function renderChapters(data) {
            const list = document.getElementById('chapterList');
            list.innerHTML = '';
            data.forEach((item, index) => {
                const badge = item.isPaid
                    ? `<span class="tag-paid"><i class="bi bi-lock-fill"></i> 付费</span>`
                    : `<span class="tag-free">免费</span>`;

                const activeClass = index === 0 ? 'active' : ''; // 默认选中第一个

                list.innerHTML += `
                    <div class="chapter-item ${activeClass} ${item.isPaid ? 'locked' : ''}" onclick="playChapter(${item.id}, '${item.title}', ${item.isPaid}, ${item.price})">
                        <div>
                            <div class="small fw-bold mb-1 text-dark">${item.title}</div>
                            <div class="text-muted" style="font-size: 11px;">
                                <i class="bi bi-play-circle"></i> ${item.duration}
                            </div>
                        </div>
                        <div class="text-end">
                            ${badge}
                        </div>
                    </div>
                `;
            });
        }

        // 筛选逻辑
        function filterType(type, btn) {
            document.querySelectorAll('.v-tab').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            if(type === 'all') {
                renderChapters(chapters);
            } else {
                const filtered = chapters.filter(c => c.type === type);
                renderChapters(filtered);
            }
        }

        // 播放逻辑
        function playChapter(id, title, isPaid, price) {
            document.querySelectorAll('.chapter-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            document.getElementById('lessonTitle').innerText = title;

            if(isPaid) {
                // 显示付费遮罩
                document.getElementById('playBtn').style.display = 'none';
                document.getElementById('lockMask').style.display = 'flex';
                // 更新按钮价格
                document.querySelector('.btn-danger').innerText = `解锁本节 (¥ ${price})`;
                document.querySelector('.btn-danger').setAttribute('onclick', `goToPay(${price})`);
            } else {
                // 免费播放
                document.getElementById('lockMask').style.display = 'none';
                document.getElementById('playBtn').style.display = 'flex';
                // 模拟重置播放器
                document.getElementById('videoCover').style.opacity = '0.8';
            }
        }

        function startVideo() {
            document.getElementById('playBtn').style.display = 'none';
            document.getElementById('videoCover').style.opacity = '0';
            // 这里可以插入真实 video 标签
            alert('视频开始播放...');
        }

        function goToPay(price) {
            // 跳转到 checkout.html 并带上价格参数（模拟）
            // 在 checkout.html 中你需要写一段 JS 来读取这个参数并更新显示价格
            window.location.href = `checkout.html?price=${price}&course=商务汉语`;
        }

        function previewFree() {
            alert('试看模式启动：播放前 30 秒...');
            document.getElementById('lockMask').style.display = 'none';
        }

        // --- AI 聊天逻辑 ---
        function toggleAiChat() {
            const chat = document.getElementById('aiChatBox');
            chat.style.display = chat.style.display === 'none' ? 'block' : 'none';
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const body = document.getElementById('chatBody');
            if(!input.value) return;

            // 用户消息
            body.innerHTML += `
                <div class="d-flex align-items-end justify-content-end mb-3">
                    <div class="bg-primary text-white p-2 rounded shadow-sm small text-start" style="max-width: 80%;">
                        ${input.value}
                    </div>
                </div>
            `;

            // 模拟回复
            setTimeout(() => {
                body.innerHTML += `
                    <div class="d-flex align-items-start mb-3">
                        <div class="bg-white p-2 rounded shadow-sm small text-dark" style="max-width: 80%;">
                            这是一个很好的问题！"${input.value}" 在商务场景中通常表示...
                        </div>
                    </div>
                `;
                body.scrollTop = body.scrollHeight; // 滚动到底部
            }, 800);

            input.value = '';
            body.scrollTop = body.scrollHeight;
        }
    </script>
</body>
</html>