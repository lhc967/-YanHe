<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>コース再生 - ビジネス中国語交渉</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root { --primary: #004aad; --accent: #ff6b00; --bg-light: #f8faff; }
        body { padding-top: 70px; background: var(--bg-light); font-family: "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif; }

        /* ナビゲーションバー */
        .navbar-custom { background: #fff; box-shadow: 0 1px 3px rgba(0,0,0,0.05); height: 70px; z-index: 1000; }
        .navbar-brand { font-weight: 900; color: var(--primary) !important; }
        .nav-avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; border: 1px solid #eee; }

        /* 動画プレーヤーエリア */
        .video-container {
            background: #000; width: 100%; aspect-ratio: 16/9; border-radius: 12px; overflow: hidden; position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .video-placeholder { width: 100%; height: 100%; object-fit: cover; opacity: 0.8; }
        .play-btn-overlay {
            position: absolute; inset: 0; display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.3); color: #fff; cursor: pointer; transition: 0.3s;
        }
        .play-btn-overlay:hover { background: rgba(0,0,0,0.5); }

        /* ロックオーバーレイ */
        .lock-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
            display: flex; flex-direction: column; align-items: center; justify-content: center; color: #fff;
            z-index: 10; display: none; /* デフォルトは非表示 */
        }

        /* プレイリストエリア */
        .playlist-card { background: #fff; border-radius: 12px; border: 1px solid #eee; height: 100%; display: flex; flex-direction: column; }
        .playlist-header { padding: 20px; border-bottom: 1px solid #eee; }
        .video-tabs { display: flex; gap: 10px; margin-top: 10px; }
        .v-tab {
            font-size: 13px; padding: 4px 12px; border-radius: 20px; background: #f5f5f5; color: #666; cursor: pointer; transition: 0.2s;
        }
        .v-tab.active { background: var(--primary); color: #fff; }

        .chapter-list { flex: 1; overflow-y: auto; padding: 0; max-height: 500px; }
        .chapter-item {
            padding: 15px 20px; border-bottom: 1px solid #f9f9f9; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: space-between; align-items: center;
        }
        .chapter-item:hover { background: #f0f7ff; }
        .chapter-item.active { background: #eef4ff; border-left: 4px solid var(--primary); }
        .chapter-item.locked { opacity: 0.7; }

        .tag-free { font-size: 10px; background: #e6f9ed; color: #28a745; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
        .tag-paid { font-size: 10px; background: #fff0f0; color: #dc3545; padding: 2px 6px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg fixed-top navbar-custom">
        <div class="container-fluid px-4">
            <a class="navbar-brand" href="home_jp.html">言禾 YanHe</a>
            <div class="d-flex align-items-center ms-auto gap-3">
                <a href="education_jp.html" class="btn btn-outline-secondary btn-sm rounded-pill px-3">カリキュラムに戻る</a>
                <img src="https://api.dicebear.com/7.x/avataaars/svg?seed=LiHua" class="nav-avatar">
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <div class="row g-4">
            <div class="col-lg-8">
                <div class="video-container" id="videoArea">
                    <img id="videoCover" src="https://images.unsplash.com/photo-1557804506-669a67965ba0?w=800" class="video-placeholder">

                    <div class="play-btn-overlay" id="playBtn" onclick="startVideo()">
                        <i class="bi bi-play-circle-fill" style="font-size: 60px;"></i>
                        <div class="mt-2 fw-bold">クリックして学習開始</div>
                    </div>

                    <div class="lock-overlay" id="lockMask">
                        <i class="bi bi-lock-fill" style="font-size: 50px; margin-bottom: 15px;"></i>
                        <h4 class="fw-bold">このセクションは有料コンテンツです</h4>
                        <p class="text-white-50 mb-4">この章および以降のすべてのスキット動画をアンロック</p>
                        <button class="btn btn-danger rounded-pill px-5 fw-bold" onclick="goToPay(99)">
                            ロック解除 (¥ 99)
                        </button>
                        <button class="btn btn-link text-white small mt-2" onclick="previewFree()">30秒お試し視聴</button>
                    </div>
                </div>

                <div class="mt-4">
                    <h2 class="fw-bold" id="lessonTitle">01. コース導入：中国人の交渉思考</h2>
                    <div class="d-flex gap-3 text-muted small mt-2">
                        <span><i class="bi bi-eye"></i> 1.2万 回視聴</span>
                        <span><i class="bi bi-star-fill text-warning"></i> 4.9 点</span>
                        <span><i class="bi bi-clock"></i> 15:00</span>
                    </div>
                    <hr>
                    <h5 class="fw-bold mt-4">コース概要</h5>
                    <p class="text-secondary">本コースは中級中国語学習者向けに設計されており、実際のビジネスシーンと組み合わせて、中国のビジネス環境における交渉戦略と言語芸術を深く分析します。</p>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="playlist-card">
                    <div class="playlist-header">
                        <h5 class="fw-bold m-0">コース目次</h5>
                        <div class="video-tabs">
                            <span class="v-tab active" onclick="filterType('all', this)">すべて</span>
                            <span class="v-tab" onclick="filterType('grammar', this)">講義</span>
                            <span class="v-tab" onclick="filterType('scenario', this)">スキット</span>
                            <span class="v-tab" onclick="filterType('culture', this)">文化</span>
                        </div>
                    </div>

                    <div class="chapter-list" id="chapterList">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <div style="position: fixed; bottom: 30px; right: 30px; z-index: 1050;">
        <button class="btn btn-primary rounded-circle shadow-lg d-flex align-items-center justify-content-center"
                style="width: 60px; height: 60px; font-size: 24px;"
                onclick="toggleAiChat()">
            <i class="bi bi-robot"></i>
        </button>
    </div>

    <div class="card shadow-lg" id="aiChatBox" style="position: fixed; bottom: 100px; right: 30px; width: 350px; height: 500px; z-index: 1050; display: none; border-radius: 16px; border: none;">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center" style="border-radius: 16px 16px 0 0;">
            <span class="fw-bold"><i class="bi bi-robot me-2"></i>AI ティーチャー</span>
            <button type="button" class="btn-close btn-close-white btn-sm" onclick="toggleAiChat()"></button>
        </div>
        <div class="card-body bg-light overflow-auto" id="chatBody">
            <div class="d-flex align-items-start mb-3">
                <div class="bg-white p-2 rounded shadow-sm small text-dark" style="max-width: 80%;">
                    こんにちは！言禾AIティーチャーです。このレッスンで分からない単語があれば、いつでも聞いてくださいね！
                </div>
            </div>
        </div>
        <div class="card-footer bg-white">
            <div class="input-group">
                <input type="text" class="form-control border-0 bg-light" placeholder="質問を入力..." id="chatInput">
                <button class="btn btn-link text-primary" onclick="sendMessage()"><i class="bi bi-send-fill"></i></button>
            </div>
        </div>
    </div>

    <script>
        // コースデータ (日本語)
        const chapters = [
            { id: 1, title: "01. 導入：中国人の交渉思考", type: "grammar", isPaid: false, duration: "15:00" },
            { id: 2, title: "02. 核心語彙：見積もりと価格交渉", type: "grammar", isPaid: false, duration: "22:30" },
            { id: 3, title: "03. シミュレーション：初対面の挨拶", type: "scenario", isPaid: true, price: 99, duration: "10:45" },
            { id: 4, title: "04. シミュレーション：会食での駆け引き", type: "scenario", isPaid: true, price: 99, duration: "18:20" },
            { id: 5, title: "05. 文化コラム：メンツ（面子）について", type: "culture", isPaid: true, price: 199, duration: "12:00" },
            { id: 6, title: "06. 契約条項の詳細解説", type: "grammar", isPaid: true, price: 199, duration: "35:00" }
        ];

        // 初期レンダリング
        renderChapters(chapters);

        function renderChapters(data) {
            const list = document.getElementById('chapterList');
            list.innerHTML = '';
            data.forEach((item, index) => {
                const badge = item.isPaid
                    ? `<span class="tag-paid"><i class="bi bi-lock-fill"></i> 有料</span>`
                    : `<span class="tag-free">無料</span>`;

                const activeClass = index === 0 ? 'active' : '';

                list.innerHTML += `
                    <div class="chapter-item ${activeClass} ${item.isPaid ? 'locked' : ''}" onclick="playChapter(${item.id}, '${item.title}', ${item.isPaid}, ${item.price})">
                        <div>
                            <div class="small fw-bold mb-1 text-dark">${item.title}</div>
                            <div class="text-muted" style="font-size: 11px;">
                                <i class="bi bi-play-circle"></i> ${item.duration}
                            </div>
                        </div>
                        <div class="text-end">
                            ${badge}
                        </div>
                    </div>
                `;
            });
        }

        // フィルタリング
        function filterType(type, btn) {
            document.querySelectorAll('.v-tab').forEach(el => el.classList.remove('active'));
            btn.classList.add('active');

            if(type === 'all') {
                renderChapters(chapters);
            } else {
                const filtered = chapters.filter(c => c.type === type);
                renderChapters(filtered);
            }
        }

        // 再生ロジック
        function playChapter(id, title, isPaid, price) {
            document.querySelectorAll('.chapter-item').forEach(el => el.classList.remove('active'));
            event.currentTarget.classList.add('active');

            document.getElementById('lessonTitle').innerText = title;

            if(isPaid) {
                // 有料マスク表示
                document.getElementById('playBtn').style.display = 'none';
                document.getElementById('lockMask').style.display = 'flex';
                // 価格更新
                document.querySelector('.btn-danger').innerText = `ロック解除 (¥ ${price})`;
                document.querySelector('.btn-danger').setAttribute('onclick', `goToPay(${price})`);
            } else {
                // 無料再生
                document.getElementById('lockMask').style.display = 'none';
                document.getElementById('playBtn').style.display = 'flex';
                document.getElementById('videoCover').style.opacity = '0.8';
            }
        }

        function startVideo() {
            document.getElementById('playBtn').style.display = 'none';
            document.getElementById('videoCover').style.opacity = '0';
            alert('動画の再生を開始します...');
        }

        function goToPay(price) {
            // 日本語版決済ページへ遷移
            window.location.href = `checkout_en.html?price=${price}&type=course`;
        }

        function previewFree() {
            alert('お試しモード：最初の30秒を再生します...');
            document.getElementById('lockMask').style.display = 'none';
        }

        // --- AI チャット ---
        function toggleAiChat() {
            const chat = document.getElementById('aiChatBox');
            chat.style.display = chat.style.display === 'none' ? 'block' : 'none';
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const body = document.getElementById('chatBody');
            if(!input.value) return;

            // ユーザーメッセージ
            body.innerHTML += `
                <div class="d-flex align-items-end justify-content-end mb-3">
                    <div class="bg-primary text-white p-2 rounded shadow-sm small text-start" style="max-width: 80%;">
                        ${input.value}
                    </div>
                </div>
            `;

            // AI応答シミュレーション
            setTimeout(() => {
                body.innerHTML += `
                    <div class="d-flex align-items-start mb-3">
                        <div class="bg-white p-2 rounded shadow-sm small text-dark" style="max-width: 80%;">
                            いい質問ですね！"${input.value}" はビジネスシーンでは通常...
                        </div>
                    </div>
                `;
                body.scrollTop = body.scrollHeight; 
            }, 800);

            input.value = '';
            body.scrollTop = body.scrollHeight;
        }
    </script>
</body>
</html>
